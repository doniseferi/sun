language: node_js
os:
  - windows
  - linux
  - osx
node_js:
  - "node"
  - lts/*
  - 12
  - 10
  - 8
  
cache:
  directories:
    - "$HOME/.npm"
script:
  - npm run build
  - npm test
  - npm run coverage

jobs:
  include:
    - stage: npm release
      node_js: "lts/*"
      script: 
        - echo "Deploying to npm ..."
        - npm run build
        - npm run publish --dry-run
      deploy:
        provider: npm
        email: doni.seferi@gmail.com
        api_key: $NPM_TOKEN
        edge: true
        access: public
        src: .
        skip_cleanup: true
        on: 
          branch: master